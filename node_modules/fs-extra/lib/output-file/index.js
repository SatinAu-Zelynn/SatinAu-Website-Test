'use strict'

<<<<<<< HEAD
const u = require('universalify').fromPromise
const fs = require('../fs')
=======
const u = require('universalify').fromCallback
const fs = require('graceful-fs')
>>>>>>> be3d05018c2d8f8afeb6fe46fe29257f998d6f3d
const path = require('path')
const mkdir = require('../mkdirs')
const pathExists = require('../path-exists').pathExists

<<<<<<< HEAD
async function outputFile (file, data, encoding = 'utf-8') {
  const dir = path.dirname(file)

  if (!(await pathExists(dir))) {
    await mkdir.mkdirs(dir)
  }

  return fs.writeFile(file, data, encoding)
=======
function outputFile (file, data, encoding, callback) {
  if (typeof encoding === 'function') {
    callback = encoding
    encoding = 'utf8'
  }

  const dir = path.dirname(file)
  pathExists(dir, (err, itDoes) => {
    if (err) return callback(err)
    if (itDoes) return fs.writeFile(file, data, encoding, callback)

    mkdir.mkdirs(dir, err => {
      if (err) return callback(err)

      fs.writeFile(file, data, encoding, callback)
    })
  })
>>>>>>> be3d05018c2d8f8afeb6fe46fe29257f998d6f3d
}

function outputFileSync (file, ...args) {
  const dir = path.dirname(file)
<<<<<<< HEAD
  if (!fs.existsSync(dir)) {
    mkdir.mkdirsSync(dir)
  }

=======
  if (fs.existsSync(dir)) {
    return fs.writeFileSync(file, ...args)
  }
  mkdir.mkdirsSync(dir)
>>>>>>> be3d05018c2d8f8afeb6fe46fe29257f998d6f3d
  fs.writeFileSync(file, ...args)
}

module.exports = {
  outputFile: u(outputFile),
  outputFileSync
}
